{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Control de Acceso - Centro Minero SENA</title>
    <link rel="stylesheet" href="{% static 'css/control.css' %}?v=1.1">
    
</head>
<body>

<!-- ===== HEADER & NAVBAR ===== -->
<header class="top-header">
    <div class="logo">
        <span class="icon">ğŸ­</span>
        <span class="brand">Centro Minero SENA</span>
    </div>
    <nav class="nav-bar">
        <a href="{% url 'index' %}" class="nav-link">Inicio</a>
        <a href="{% url 'usuarios:listar_usuarios' %}" class="nav-link">Usuarios</a>
        <a href="{% url 'ambientes:listar_ambientes' %}" class="nav-link">Ambientes</a>
        <a href="#" class="nav-link">Reportes</a>
        <a href="#" class="nav-link">ConfiguraciÃ³n</a>
    </nav>
</header>

<!-- ===== CONTENIDO PRINCIPAL ===== -->
<main class="container">

    <!-- Selector de Ambiente -->
    <section class="card fade-in">
        <div class="card-title">ğŸ“ SelecciÃ³n de Ambiente</div>
        <div class="ambiente-selector">
            <select id="ambienteSelect" onchange="cambiarAmbiente()">
                <option value="sistemas">ğŸ’» Laboratorio de Sistemas</option>
                <option value="quimica">ğŸ§ª Laboratorio de QuÃ­mica Aplicada</option>
                <option value="carbones">âš« Laboratorio de Carbones</option>
                <option value="biotecnologia">ğŸ§¬ Laboratorio de BiotecnologÃ­a</option>
                <option value="beneficios">â›ï¸ Lab. Beneficios Minerales</option>
                <option value="aguas">ğŸ’§ Laboratorio de Aguas</option>
                <option value="suelos">ğŸŒ± Laboratorio de Suelos</option>
                <option value="abc_maquinaria">ğŸšœ Ambiente ABC - Maquinaria Pesada</option>
                <option value="bilinguismo">ğŸ—£ï¸ Ambiente de BilingÃ¼ismo</option>
                <option value="minas_didacticas">â›ï¸ Minas DidÃ¡cticas</option>
            </select>
        </div>
        <div id="ambienteInfo" class="ambiente-info">
            ğŸ’» Laboratorio de Sistemas
            <span class="risk-indicator risk-bajo">Riesgo: Bajo</span>
        </div>
    </section>

    <!-- GRID PRINCIPAL -->
    <div class="main-grid">

        <!-- PANEL ACCESO -->
        <section class="card">
            <div class="card-title">ğŸ” Control de Acceso</div>

            <!-- CÃ¡mara -->
            <div class="camera-container">
                <div class="camera-view" id="cameraView">
                    <div id="cameraStatus">
                        ğŸ“¹ CÃMARA DESACTIVADA<br>
                        <small>Presiona â€œActivar CÃ¡maraâ€ para iniciar</small>
                    </div>
                    <video id="videoElement" style="display:none;" autoplay></video>
                    <div class="camera-overlay" id="cameraOverlay" style="display:none;">
                        ğŸ” Buscando rostros...
                    </div>
                </div>

                <div class="face-detection-area" id="faceDetection" style="display:none;">
                    <div style="text-align:center; color:#74b9ff;">
                        ğŸ‘¤ Ãrea de DetecciÃ³n Facial Activa
                    </div>
                </div>

                <div class="camera-controls">
                    <button class="btn btn-success" onclick="toggleCamera()">
                        <span id="cameraButtonText">Activar CÃ¡mara</span>
                    </button>
                    <button class="btn btn-primary" onclick="simularReconocimiento()">
                        Simular Reconocimiento
                    </button>
                </div>
            </div>

            <!-- Acceso Manual -->
            <div class="manual-access">
                <h4 style="margin-bottom:15px; color:#2c3e50;">ğŸ« Acceso Manual por Carnet</h4>
                <form method="post" id="accesoForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label">ğŸ‘¤ Usuario:</label>
                        {{ form.usuario }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ğŸ“ Ambiente:</label>
                        {{ form.laboratorio }}
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ğŸ”§ MÃ©todo de Acceso:</label>
                        {{ form.metodo }}
                    </div>
                    <button type="submit" class="btn btn-danger w-100">
                        âœ… Registrar Acceso
                    </button>
                </form>
            </div>

            <!-- Tabla accesos recientes -->
            <div style="margin-top:20px;">
                <h5>ğŸ“‹ Accesos recientes</h5>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Ambiente</th>
                            <th>MÃ©todo</th>
                            <th>Fecha / Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for acceso in accesos_lista %}
                        <tr>
                            <td>{{ acceso.usuario.nombre }}</td>
                            <td>{{ acceso.get_laboratorio_display }}</td>
                            <td>{{ acceso.get_metodo_display }}</td>
                            <td>{{ acceso.fecha_hora|date:"Y-m-d H:i" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" style="text-align:center; padding:10px; color:#7f8c8d;">
                                No hay accesos registrados.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

        <!-- PANEL ESTADO -->
        <aside class="card">
            <div class="card-title">ğŸ“Š Estado del Sistema</div>
            <div class="status-panel">
                <div id="statusIndicator" class="status-indicator status-denied">
                    ğŸ”´ ACCESO DENEGADO<br>
                    <small>Esperando identificaciÃ³n...</small>
                </div>
                <div id="userInfo" class="user-info">
                    <p style="color:#7f8c8d; font-style:italic;">No hay usuario identificado</p>
                </div>
            </div>
            <div class="card-title" style="margin-top:30px;">ğŸ“‹ Log de Accesos</div>
            <div id="logContainer" class="log-container">
                <div style="color:#74b9ff;">[SISTEMA INICIADO]</div>
                <div>Esperando identificaciÃ³n de usuarios...</div>
            </div>
        </aside>
    </div>
</main>

<!-- ===== FOOTER ===== -->
<footer class="footer">
    <p>ğŸ’¡ Sistema Inteligente de Control de Acceso - Centro Minero SENA Â© 2025</p>
    <p class="footer-links">
        <a href="#">PolÃ­ticas</a> |
        <a href="#">Soporte</a> |
        <a href="#">Acerca de</a>
    </p>
</footer>

<!-- Modal -->
<div id="protocolModal" class="protocol-modal">
    <div class="protocol-content">
        <h3 id="protocolTitle">Protocolo de Seguridad</h3>
        <p id="protocolText"></p>
        <button class="btn btn-primary" onclick="cerrarProtocolo()">Entendido</button>
    </div>
</div>

<div id="notification" class="notification"></div>
<script src="{% static 'js/control.js' %}"></script>
</body>
</html>
